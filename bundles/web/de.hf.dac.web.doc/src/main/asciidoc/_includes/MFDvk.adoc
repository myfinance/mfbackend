include::header.adoc[]

= DB Model

.MyFinance Data Model
image::mf_db_model.png[MyFinance Data Model]

.Dac Data Model
image::dac_db_model.png[Dac Data Model]

= APIs

Die von der MyFinance Infrastruktur bereitgestellten Funktionalitäten und werden über APIs zugänglich gemacht. Eine API bündelt eine fachliche und/oder technische Menge von Funktionen, mit denen der Funktionsumfang einer Anwendung möglichst vollständig und kontrolliert über standardisierte Schnittstellen zugänglich gemacht wird.

[plantuml]
.APIs machen Funktionalität zugänglich
....
@startuml
!pragma graphviz_dot jdot
skinparam componentStyle uml2

cloud {
    [Client1]
    [Client2]
}

frame "APIs" {
    RESTAPI1 - [API1]
    RESTAPI2 - [API2]
}

frame Applications {
    [Application1]
    [Application2]
}

frame SharedComponents {
    [SharedComponent1]
    [SharedComponent2]
}


[Client1] --> RESTAPI1
[Client2] --> RESTAPI1
[Client2] --> RESTAPI2
[API1] --> [Application1]
[API2] --> [Application2]
[Application1] --> [SharedComponent1]
[Application1] --> [SharedComponent2]
[Application2] --> [SharedComponent1]
@enduml
....


= Environments

Environments bündeln Backend-Systeme nach fachlichen oder auch technischen Kriterien, und stellen damit Anwendungen den Kontext zur Verfügung.

[plantuml]
.Environments bündeln Backends
....
@startuml
!pragma graphviz_dot jdot
skinparam componentStyle uml2


frame Applications {
    [Application1]
    [Application2]
}

frame Environments {
    folder Environment1 {
        database db1a {
        }
        database db2a {
        }
    }
    folder Environment2 {
        database db1b {
        }
        database db2b {
        }
    }
}

Request - [Environment]: determines
[Environment] --> [Application1]: execute
[Environment] --> db1a: with
[Environment] --> db2a: with

@enduml
....


= Implementierte APIs

Es existieren aktuell folgende APIs, die produktiv genutzt werden:

[%autowidth.spread,cols=3*,options="header"]
|===
|Name|Environment-basiert (*) |Beschreibung
|link:/api-docs/#/MyFinance[MyFinance]
|Ja
|mit dieser Api können Daten für MyFinance gepflegt und abgefragt werden

|link:/api-docs/#/Jobs[Jobs]
|Ja
|Eine Api zum Starten von Jobs>.

|===

(*) Environment-basiert: Die APIs können je nach übergebener EnvironmentID in unterschiedlichen fachlichen und technischen System-Umgebungen wirken

TIP: Unter link:/api-docs3[Api Docs] sind noch mehr als die oben gelisteten Kategorien / API-Top Level zu sehen - dies hat einerseits technische Gründe, andererseits sind dort auch Test- und abzuschaltende APIs aufgelistet.


= coding conventions for Rest:

== When should you use Path Variable, and how about Query Parameter?
If you want to identify a resource, you should use Path Variable. But if you want to sort or filter items, then you should use query parameter.
/users # Fetch a list of users
/users?occupation=programer # Fetch a list of programer user
/users/123 # Fetch a user who has id 123

== Response

in case of an error throw a runtime exception -> a http 500 message will be sent with the exception and the client know what happens

In case of success without a returnvalue: Response.ok().build();

Allways return the type "response" and convert the returnvalue to json Response.ok(LeafResource.SerializeToJSON("test")).build();
If you return a String you will get "can't parse JSON.  Raw result:"

Return value type should allways(if you use the Get methode) inherit from LeafResource to get the url and data embedded in the response json