<?xml version="1.0" encoding="UTF-8"?>
<features name="marketdata-jdbc-features" xmlns="http://karaf.apache.org/xmlns/features/v1.3.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://karaf.apache.org/xmlns/features/v1.3.0 http://karaf.apache.org/xmlns/features/v1.3.0">

    <repository>mvn:org.apache.karaf.features/enterprise/4.0.5/xml/features</repository>

    <feature name="marketdata-datasourcefactory" version="${pom.version}">
        <!-- erstellt Datasource mit hilfe von Datasourcefactory entsprechend etc/org.ops4j.datasource-xxx.cfg -->
        <bundle  start-level="80">wrap:mvn:org.jasypt/jasypt/1.9.2</bundle>
        <bundle  start-level="80">mvn:org.ops4j.pax.jdbc/pax-jdbc-config/0.9.0</bundle>
        <bundle  start-level="80">mvn:org.osgi/org.osgi.service.jdbc/1.0.0</bundle>
        <capability>osgi.service;effective:=active;objectClass=org.osgi.service.jdbc.DataSourceFactory</capability>
    </feature>

    <feature name="marketdata-pooleddatasourcefactory" version="${pom.version}">
        <!-- zum wrappen von Datasourcefactories fuer pooled connections -->
        <bundle  start-level="80">mvn:org.osgi/org.osgi.service.jdbc/1.0.0</bundle>
        <bundle start-level="80">mvn:org.ops4j.pax.jdbc/pax-jdbc-pool-common/0.9.0</bundle>
        <bundle start-level="80">mvn:org.apache.commons/commons-pool2/2.4.1</bundle>
        <bundle start-level="80">mvn:org.apache.commons/commons-dbcp2/2.1</bundle>
        <bundle start-level="80">mvn:org.ops4j.pax.jdbc/pax-jdbc-pool-dbcp2/0.9.0</bundle>
        <capability>osgi.service;effective:=active;objectClass=org.osgi.service.jdbc.DataSourceFactory</capability>
    </feature>

    <feature name="marketdata-datasource" version="${pom.version}">
        <!--<feature>marketdata-datasourcefactory</feature>-->
        <feature>marketdata-pooleddatasourcefactory</feature>
        <!-- erstellt Datasource mit hilfe von Datasourcefactory entsprechend etc/org.ops4j.datasource-xxx.cfg -->
        <bundle  start-level="80">wrap:mvn:org.jasypt/jasypt/1.9.2</bundle>
        <bundle  start-level="80">mvn:org.ops4j.pax.jdbc/pax-jdbc-config/0.9.0</bundle>
        <bundle  start-level="80">mvn:org.osgi/org.osgi.service.jdbc/1.0.0</bundle>
        <capability>osgi.service;effective:=active;objectClass=javax.sql.DataSource</capability>
    </feature>

    <feature name="marketdata-jdbc" version="${pom.version}">
        <feature>marketdata-datasource</feature>
        <!-- for JPA Template to handle transactions with declarative services-->
        <bundle>mvn:org.apache.aries.jpa/org.apache.aries.jpa.api/2.4.0</bundle>
        <bundle>mvn:org.apache.aries.jpa/org.apache.aries.jpa.container/2.4.0</bundle>
        <capability>osgi.service;effective:=active;objectClass=org.apache.aries.jpa.template.JpaTemplate</capability>
        <!--creates xa-datasourcefactory means datasources for distributed transactions-->
        <bundle>mvn:org.apache.aries.transaction/org.apache.aries.transaction.manager/1.3.0</bundle>
    </feature>
</features>